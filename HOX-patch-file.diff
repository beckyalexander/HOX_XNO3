From b0ebb1cce7d75b40781184b75b048dd7bbdecbc2 Mon Sep 17 00:00:00 2001
From: Becky Alexander <beckya@atmos.washington.edu>
Date: Thu, 27 Jun 2024 15:35:02 -0700
Subject: [PATCH 1/4] Remove unnecessary slash in file path in photolysis_mod.
 Don't do this if it's not a problem for you.

---
 GeosCore/photolysis_mod.F90 | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/GeosCore/photolysis_mod.F90 b/GeosCore/photolysis_mod.F90
index 0eaf45bad..8b6a72fe4 100644
--- a/GeosCore/photolysis_mod.F90
+++ b/GeosCore/photolysis_mod.F90
@@ -936,7 +936,8 @@ CONTAINS
 
        ! Choose different set of input files for standard (trop+strat chenm)
        ! and tropchem (trop-only chem) simulations
-       THISFILE = TRIM( DATA_DIR ) // '/' // TRIM( SPECFIL(k) )
+!       THISFILE = TRIM( DATA_DIR ) // '/' // TRIM( SPECFIL(k) )
+       THISFILE = TRIM( DATA_DIR ) // TRIM( SPECFIL(k) )
 
        !--------------------------------------------------------------
        ! In dry-run mode, print file path to dryrun log and cycle.
-- 
2.30.2


From 8c4fd6914a74e0517d7d2932fdb0e1614d1d97a7 Mon Sep 17 00:00:00 2001
From: Becky Alexander <beckya@atmos.washington.edu>
Date: Fri, 5 Jul 2024 11:48:45 -0700
Subject: [PATCH 2/4] Added competing reactions HOI + SO2/Cl-/Br- in clouds.

---
 GeosCore/fullchem_mod.F90                 |   7 +-
 KPP/fullchem/commonIncludeVars.H          |   9 +-
 KPP/fullchem/fullchem.eqn                 |  11 +-
 KPP/fullchem/fullchem_RateLawFuncs.F90    | 463 ++++++++++++++++++++++
 KPP/fullchem/fullchem_SulfurChemFuncs.F90 |  39 +-
 5 files changed, 514 insertions(+), 15 deletions(-)

diff --git a/GeosCore/fullchem_mod.F90 b/GeosCore/fullchem_mod.F90
index de50dfa2a..86dd833c9 100644
--- a/GeosCore/fullchem_mod.F90
+++ b/GeosCore/fullchem_mod.F90
@@ -558,9 +558,10 @@ CONTAINS
        K_CLD     = 0.0_dp                   ! Sulfur in-cloud rxn het rates
        K_MT      = 0.0_dp                   ! Sulfur sea salt rxn het rates
        CFACTOR   = 1.0_dp                   ! KPP conversion factor
-       SRO3      = 0.0_dp                   ! Enhanced sulfate production of
-       SRHOBr    = 0.0_dp                   !  O3, HOBr, HCl in size-resolved
-       SRHOCl    = 0.0_dp                   !  cloud droplets
+       SRO3      = 0.0_dp                   ! Enhanced sulfate production by
+       SRHOBr    = 0.0_dp                   ! O3, HOBr, HOCl, HOI oxidation in 
+       SRHOCl    = 0.0_dp                   ! size-resolved
+       SRHOI     = 0.0_dp                   ! cloud droplets
 #ifdef MODEL_CLASSIC
 #ifndef NO_OMP
        Thread    = OMP_GET_THREAD_NUM() + 1 ! OpenMP thread number
diff --git a/KPP/fullchem/commonIncludeVars.H b/KPP/fullchem/commonIncludeVars.H
index b7b8881d7..d788126eb 100644
--- a/KPP/fullchem/commonIncludeVars.H
+++ b/KPP/fullchem/commonIncludeVars.H
@@ -104,10 +104,10 @@
   !$OMP THREADPRIVATE( H_PLUS )
 
   ! Enhanced sulfate production from SO2 oxidation by HOBr, HOCl, 
-  ! and O3 in size-resolved cloud droplets [cm3/molec/s]
-  ! -- Becky Alexander (30 Jan 2023)
-  REAL(dp) :: SRHOBr, SRHOCl, SRO3	
-  !$OMP THREADPRIVATE( SRHOBr, SRHOCl, SRO3 )
+  ! HOI, and O3 in size-resolved cloud droplets [cm3/molec/s]
+  ! -- Becky Alexander (30 Jan 2023, 5 July 2024)
+  REAL(dp) :: SRHOBr, SRHOCl, SRO3, SRHOI	
+  !$OMP THREADPRIVATE( SRHOBr, SRHOCl, SRHOI, SRO3 )
   
   TYPE, PUBLIC :: HetState
      REAL(dp) :: AVO            ! Avogadro's constant [molec/mol]
@@ -150,6 +150,7 @@
      REAL(dp) :: frac_SO3_aq    ! SO3_aq  / ( HSO3_aq + SO3_aq )
      REAL(dp) :: fupdateHOBr    ! Correction factor - HOBr
      REAL(dp) :: fupdateHOCl    ! Correction factor - HOCl
+     REAL(dp) :: fupdateHOI     ! Correction factor - HOI
      REAL(dp) :: gamma_HO2      ! Uptake probability for HO2  [1]
      REAL(dp) :: H2O            ! H2O concentration
      REAL(dp) :: HBr_theta      ! HBr theta for uptake on ice
diff --git a/KPP/fullchem/fullchem.eqn b/KPP/fullchem/fullchem.eqn
index 9d7ea2b2e..5b28e1020 100644
--- a/KPP/fullchem/fullchem.eqn
+++ b/KPP/fullchem/fullchem.eqn
@@ -1468,6 +1468,9 @@ HI = ISALA :                   IuptkBySALA1stOrd( SR_MW(ind_HI), 0.10_dp, State_
 HI = ISALC :                   IuptkBySALC1stOrd( SR_MW(ind_HI), 0.10_dp, State_Het );                      {2017/09/22; Sherwen2016b;TS,JAS,SDE}
 HOI = ISALA :                  IuptkByAlkSALA1stOrd( SR_MW(ind_HOI), 0.01_dp, State_Het );                  {2023/01/24; Restored deleted rxn:BA}
 HOI = ISALC :                  IuptkByAlkSALC1stOrd( SR_MW(ind_HOI), 0.01_dp, State_Het );                  {2022/12/02; Restored deleted rxn:BA}
+HOI + SO2 = SO4 + HI :         HOIUptkByHSO3m( State_Het ) + HOIUptkBySO3mm( State_Het ) + SRHOI;           {2024/07/05; BAlexander}
+HOI + HBr = IBr + H2O :        HOIUptkByHBr( State_Het ) ;                                                  {2024/07/05; BAlexander}
+HOI + HCl = ICl + H2O :        HOIUptkByHCl( State_Het ) ;                                                  {2024/07/05; BAlexander}
 I2O2 = 2.000AERI :             IuptkBySulf1stOrd( SR_MW(ind_I2O2), 0.02_dp, State_Het );                    {2017/09/22; Sherwen2016b;TS,JAS,SDE}
 I2O2 = 2.000ISALA :            IuptkBySALA1stOrd( SR_MW(ind_I2O2), 0.02_dp, State_Het );                    {2017/09/22; Sherwen2016b;TS,JAS,SDE}
 I2O2 = 2.000ISALC :            IuptkBySALC1stOrd( SR_MW(ind_I2O2), 0.02_dp, State_Het );                    {2017/09/22; Sherwen2016b;TS,JAS,SDE}
@@ -1490,10 +1493,10 @@ IONO2 + BrSALA = IBr + HNO3 :  IbrkdnByAcidBrSALA( SR_MW(ind_IONO2), C(ind_IONO2
 IONO2 + BrSALC = IBr + HNO3 :  IbrkdnByAcidBrSALC( SR_MW(ind_IONO2), C(ind_IONO2), 0.01_dp, State_Het );    {2017/09/22; Sherwen2017;TS,JAS,SDE,XW}
 IONO2 + SALACL = ICl + HNO3 :  IbrkdnByAcidSALACl( SR_MW(ind_IONO2), C(ind_IONO2), 0.01_dp, State_Het );    {2017/09/22; Sherwen2017;TS,JAS,SDE,XW}
 IONO2 + SALCCL = ICl + HNO3 :  IbrkdnByAcidSALCCl( SR_MW(ind_IONO2), C(ind_IONO2), 0.01_dp, State_Het );    {2017/09/22; Sherwen2017;TS,JAS,SDE,XW}
-HOI + BrSALA = IBr :           IbrkdnByAcidBrSALA( SR_MW(ind_HOI), C(ind_HOI), 0.01_dp, State_Het );        {2017/09/22; Sherwen2017;TS,JAS,SDE,XW}
-HOI + BrSALC = IBr :           IbrkdnByAcidBrSALC( SR_MW(ind_HOI), C(ind_HOI), 0.01_dp, State_Het );        {2017/09/22; Sherwen2017;TS,JAS,SDE,XW}
-HOI + SALACL = ICl :           IbrkdnByAcidSALACl( SR_MW(ind_HOI), C(ind_HOI), 0.01_dp, State_Het );        {2017/09/22; Sherwen2017;TS,JAS,SDE,XW}
-HOI + SALCCL = ICl :           IbrkdnByAcidSALCCl( SR_MW(ind_HOI), C(ind_HOI), 0.01_dp, State_Het );        {2017/09/22; Sherwen2017;TS,JAS,SDE,XW}
+HOI + BrSALA = IBr :           HOIUptkByBrSALA( State_Het ) ;                                      ;        {2024/07/05; BAlexander}
+HOI + BrSALC = IBr :           HOIUptkByBrSALC( State_Het ) ;                                      ;        {2024/07/05; BAlexander}
+HOI + SALACL = ICl :           HOIUptkBySALACl( State_Het ) ;                                      ;        {2024/07/05; BAlexander}
+HOI + SALCCL = ICl :           HOIUptkBySALCCl( State_Het ) ;                                      ;        {2024/07/05; BAlexander}
 GLYX = SOAGX :                 GLYXuptk1stOrd( SR_MW(ind_GLYX), State_Het);                                 {2017/06/15; Marais2016, EAM}
 MGLY = 1.500SOAGX :            MGLYuptk1stOrd( SR_MW(ind_MGLY), State_Het);                                 {2017/06/15; Marais2016, EAM; 2023/04/18; Bates2023; KHB}
 IEPOXA = SOAIE :               IEPOXuptk1stOrd( SR_MW(ind_IEPOXA), .FALSE., State_Het );                    {2017/06/15; Marais2016, EAM}
diff --git a/KPP/fullchem/fullchem_RateLawFuncs.F90 b/KPP/fullchem/fullchem_RateLawFuncs.F90
index 246289eee..da3e0dc02 100644
--- a/KPP/fullchem/fullchem_RateLawFuncs.F90
+++ b/KPP/fullchem/fullchem_RateLawFuncs.F90
@@ -2541,6 +2541,198 @@ CONTAINS
     ENDIF
   END FUNCTION IbrkdnbyAcidSALCCl
 
+  FUNCTION HOIUptkByBrSALA( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOI + BrSALA reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: ssarea,       branch,    branch_0
+    REAL(dp) :: brLiq,        gammaAer,  gammaLiq
+    REAL(dp) :: k_HOI_Cl,    k_HOI_Br, k_HOI_HSO3m
+    REAL(dp) :: k_HOI_SO3mm, k_tot,     srMw
+    !
+    k        = 0.0_dp
+    brLiq    = 0.0_dp
+    gammaAer = 0.01_dp
+    gammaLiq = 0.0_dp
+    srMw     = SR_MW(ind_HOI)
+    !
+
+    IF ( H%stratBox ) RETURN
+
+!    IF (  .not. H%stratBox ) THEN
+       !
+       ! HOI + Br- rxn probability in tropospheric liquid cloud. Assume same rate constants
+       ! for HOI + Br-/Cl- as HOBr + Br-/Cl- because Mossinger & Cox [2001] show that the
+       ! gamma values for the HOI reactions is the same as for the HOBr reactions
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,                &
+                        k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm )
+       !
+       ! Assume same branching ratio for liquid path of HOI + BrSALA in cloud
+       ! as in aerosol (IBr:ICl = 0.15:0.85)
+       brLiq = 0.15_dp * H%frac_Br_CldA
+       !
+       ! Compute overall HOI removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, 0.0_dp, brLiq, 0.0_dp )
+       !
+!    ENDIF
+    !
+    ! Now consider HOI uptake by acidic BrSALA in clear-sky
+    IF ( H%SSA_is_Acid ) THEN
+       ssarea = H%ClearFr * (1.0_dp - H%f_Alk_SSA) * H%xArea(SSA)
+!       k = 0.15_dp * IuptkBySALA1stOrd( srMw, gamma, H )
+       k = 0.15_dp * Ars_L1K( ssarea, H%xRadi(SSA), srMw, gammaAer )
+       k = kIIR1Ltd( C(ind_HOI), C(ind_BrSALA), k ) ! HOI is limiting, so update k
+    ENDIF
+
+  END FUNCTION HOIUptkByBrSALA
+
+  FUNCTION HOIUptkByBrSALC( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOI + BrSALA reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: ssarea,       branch,    branch_0
+    REAL(dp) :: brLiq,        gammaAer,  gammaLiq
+    REAL(dp) :: k_HOI_Cl,    k_HOI_Br, k_HOI_HSO3m
+    REAL(dp) :: k_HOI_SO3mm, k_tot,     srMw
+    !
+    k        = 0.0_dp
+    brLiq    = 0.0_dp
+    gammaAer = 0.01_dp
+    gammaLiq = 0.0_dp
+    srMw     = SR_MW(ind_HOI)
+    !
+
+    IF ( H%stratBox ) RETURN
+
+!    IF (  .not. H%stratBox ) THEN
+       !
+       ! HOI + Br- rxn probability in tropospheric liquid cloud.  Assume same rate constants
+       ! for HOI + Br-/Cl- as HOBr + Br-/Cl- because Mossinger & Cox [2001] show that the
+       ! gamma values for the HOI reactions is the same as for the HOBr reactions
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,                &
+                        k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm )
+       !
+       ! Assume same branching ratio for liquid path of HOI + BrSALA in cloud
+       ! as in aerosol (IBr:ICl = 0.15:0.85)
+       brLiq = 0.15_dp * H%frac_Br_CldC
+       !
+       ! Compute overall HOBr removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, 0.0_dp, brLiq, 0.0_dp )
+       !
+!    ENDIF
+    !
+    ! Now consider HOI uptake by acidic BrSALA in clear-sky
+    IF ( H%SSA_is_Acid ) THEN
+       ssarea = H%ClearFr * (1.0_dp - H%f_Alk_SSA) * H%xArea(SSA)
+!       k = 0.15_dp * IuptkBySALA1stOrd( srMw, gamma, H )
+       k = 0.15_dp * Ars_L1K( ssarea, H%xRadi(SSA), srMw, gammaAer )
+       k = kIIR1Ltd( C(ind_HOI), C(ind_BrSALC), k ) ! HOI is limiting, so update k
+    ENDIF
+
+  END FUNCTION HOIUptkByBrSALC
+
+  FUNCTION HOIUptkBySALACl( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOI + SALACl reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: ssarea,       branch,    branch_0
+    REAL(dp) :: brLiq,        gammaAer,  gammaLiq
+    REAL(dp) :: k_HOI_Cl,    k_HOI_Br, k_HOI_HSO3m
+    REAL(dp) :: k_HOI_SO3mm, k_tot,     srMw
+    !
+    k        = 0.0_dp
+    brLiq    = 0.0_dp
+    gammaAer = 0.01_dp
+    gammaLiq = 0.0_dp
+    srMw     = SR_MW(ind_HOI)
+    !
+
+    IF ( H%stratBox ) RETURN
+
+!    IF (  .not. H%stratBox ) THEN
+       !
+       ! HOI + Cl- rxn probability in tropospheric liquid cloud. Assume same rate constants
+       ! for HOI + Br-/Cl- as HOBr + Br-/Cl- because Mossinger & Cox [2001] show that the
+       ! gamma values for the HOI reactions is the same as for the HOBr reactions
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,    &
+            k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm )
+       !
+       ! Assume same branching ratio for liquid path of HOI + BrSALA in cloud
+       ! as in aerosol (IBr:ICl = 0.15:0.85)
+       brLiq = 0.85_dp * H%frac_Cl_CldA
+       !
+       ! Compute overall HOI removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, 0.0_dp, brLiq, 0.0_dp )
+       !
+!    ENDIF
+    !
+    ! Now consider HOI uptake by acidic SALACl in clear-sky
+    IF ( H%SSA_is_Acid ) THEN
+       ssarea = H%ClearFr * (1.0_dp - H%f_Alk_SSA) * H%xArea(SSA)
+!       k = 0.15_dp * IuptkBySALA1stOrd( srMw, gamma, H )
+       k = 0.85_dp * Ars_L1K( ssarea, H%xRadi(SSA), srMw, gammaAer )
+       k = kIIR1Ltd( C(ind_HOI), C(ind_SALACl), k ) ! HOI is limiting, so update k
+    ENDIF
+
+  END FUNCTION HOIUptkBySALACl
+
+  FUNCTION HOIUptkBySALCCl( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOI + BrSALA reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: ssarea,       branch,    branch_0
+    REAL(dp) :: brLiq,        gammaAer,  gammaLiq
+    REAL(dp) :: k_HOI_Cl,    k_HOI_Br, k_HOI_HSO3m
+    REAL(dp) :: k_HOI_SO3mm, k_tot,     srMw
+    !
+    k        = 0.0_dp
+    brLiq    = 0.0_dp
+    gammaAer = 0.01_dp
+    gammaLiq = 0.0_dp
+    srMw     = SR_MW(ind_HOI)
+    !
+
+    IF ( H%stratBox ) RETURN
+
+!    IF (  .not. H%stratBox ) THEN
+       !
+       ! HOI + Cl- rxn probability in tropospheric liquid cloud.  Assume same rate constants
+       ! for HOI + Br-/Cl- as HOBr + Br-/Cl- because Mossinger & Cox [2001] show that the
+       ! gamma values for the HOI reactions is the same as for the HOBr reactions
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,                 &
+                        k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm )
+       !
+       ! Assume same branching ratio for liquid path of HOI + BrSALA in cloud
+       ! as in aerosol (IBr:ICl = 0.15:0.85)
+       brLiq = 0.85_dp * H%frac_Cl_CldC
+       !
+       ! Compute overall HOBr removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, 0.0_dp, brLiq, 0.0_dp )
+       !
+!    ENDIF
+    !
+    ! Now consider HOI uptake by acidic BrSALA in clear-sky
+    IF ( H%SSA_is_Acid ) THEN
+       ssarea = H%ClearFr * (1.0_dp - H%f_Alk_SSA) * H%xArea(SSA)
+!       k = 0.15_dp * IuptkBySALA1stOrd( srMw, gamma, H )
+       k = 0.85_dp * Ars_L1K( ssarea, H%xRadi(SSA), srMw, gammaAer )
+       k = kIIR1Ltd( C(ind_HOI), C(ind_SALCCl), k ) ! HOI is limiting, so update k
+    ENDIF
+
+  END FUNCTION HOIUptkBySALCCl
+
   FUNCTION IONO2uptkByH2O( H ) RESULT( k )
     !
     ! Computes the reaction rate [1/s] for IONO2 + H2O = HOI + HNO3
@@ -2576,6 +2768,277 @@ CONTAINS
     k = kIIR1Ltd( C(ind_IONO2), C(ind_H2O), k )
   END FUNCTION IONO2uptkByH2O
 
+  SUBROUTINE Gam_HOI_Cld( H,         gamma,     k_tot,                 &
+                          k_HOI_Cl, k_HOI_Br, k_HOI_HSO3, k_HOI_HSO3_2 )
+    !
+    ! Returns uptake probability for HOI in clouds.
+    !
+    TYPE(HetState), INTENT(IN)  :: H        ! Hetchem species metadata
+    REAL(dp),       INTENT(OUT) :: gamma
+    REAL(dp),       INTENT(OUT) :: k_tot
+    REAL(dp),       INTENT(OUT) :: k_HOI_Cl
+    REAL(dp),       INTENT(OUT) :: k_HOI_Br
+    REAL(dp),       INTENT(OUT) :: k_HOI_HSO3
+    REAL(dp),       INTENT(OUT) :: k_HOI_HSO3_2
+    !
+    REAL(dp) :: gd,   M_X,  cavg,  H_X,   gb_tot
+    REAL(dp) :: ybr2, l_r,  C_Hp1, C_Hp2, Br_over_Cl
+    !
+    REAL(dp), PARAMETER :: INV_AB = 1.0_dp / 0.6_dp ! Inv. mass accum coef
+    REAL(dp), PARAMETER :: D_l    = 1.4e-5_dp       ! Amman et al, ACP, 2013
+    !
+    ! Henry's law
+    H_X    = ( HENRY_K0(ind_HOI) * CON_ATM_BAR )                            &
+           * EXP( HENRY_CR(ind_HOI) * ( 1.0_dp/TEMP - INV_T298 ) )
+    !
+    ! Thermal velocity [cm/s]
+    M_X    = MW(ind_HOI) * 1.0e-3_dp
+    cavg   = SQRT( EIGHT_RSTARG_T / ( H%PI * M_X ) ) * 100.0_dp
+    !
+    ! Follow Roberts et al, (2014)
+    C_Hp1  = MIN( H%H_conc_lCl, 1.0e-6_dp )
+    C_Hp2  = MIN( H%H_conc_lCl, 1.0e-2_dp )
+    C_Hp1  = MAX( C_Hp1,        1.0e-9_dp )
+    C_Hp2  = MAX( C_Hp2,        1.0e-6_dp )
+    !
+    ! Rates for each HOI + {Cl-, Br-, HSO3-, HSO3--} rxn. Use same rate coefficient as for HOBr
+    k_HOI_Cl     = 2.3e+10_dp * H%Cl_conc_Cld * C_Hp1  ! Liu & Margerum, EST, 2001
+    k_HOI_Br     = 1.6e+10_dp * H%Br_conc_Cld * C_Hp2  ! ??
+    k_HOI_HSO3   = 2.6e+7_dp  * H%HSO3_aq ! Liu and Abbatt, GRL, 2020
+    k_HOI_HSO3_2 = 5.0e+9_dp  * H%SO3_aq  ! Troy & Margerum, Inorg. Chem., 1991
+    !
+    ! Total rate
+    k_tot  = k_HOI_Cl + k_HOI_Br + k_HOI_HSO3 + k_HOI_HSO3_2
+    !
+    ! Compue reactive uptake coefficient [unitless], prevent div by zero
+    ! l_r is diffusive length scale [cm];
+    ! gb is Bulk reaction coefficient [unitless]
+    gamma  = 0.0_dp
+    IF ( k_tot > 0.0_dp ) THEN
+       l_r    = SQRT( D_l / k_tot )
+       gb_tot = FOUR_R_T * H_X * l_r * k_tot / cavg
+       gb_tot = gb_tot * ReactoDiff_Corr( H%rLiq, l_r )
+       gamma  = 1.0_dp / ( INV_AB + 1.0 / gb_tot )
+    ENDIF
+  END SUBROUTINE Gam_HOI_Cld
+
+  SUBROUTINE Gam_HOI_Ice( H, gamma, branch_HCl, branch_HBr )
+    !
+    ! Calculates total reactive uptake coefficient for
+    ! HOI + HCl and HOI + HBr in ice clouds.
+    !
+    TYPE(HetState), INTENT(IN)  :: H              ! Hetchem State
+    REAL(dp),       INTENT(OUT) :: gamma          ! Total rxn prob [1]
+    REAL(dp),       INTENT(OUT) :: branch_HCl     ! HCl branch ratio
+    REAL(dp),       INTENT(OUT) :: branch_HBr     ! HBr branch ratio
+    !
+    REAL(dp) :: gamma_HCl, gamma_HBr              ! local vars
+    !
+    ! Overall uptake prob. of  HOI+HCl and HOI+HBr together
+    gamma_HCl = H%HCl_theta * 0.25_dp
+    gamma_HBr = H%HBr_theta * 4.8e-4_dp * EXP( 1240.0_dp / TEMP )
+    gamma     = gamma_HCl + gamma_HBr
+    !
+    ! Branching ratios HCl/total and HBr/total
+    branch_HCl = 0.0_dp
+    branch_HBr = 0.0_dp
+    IF ( gamma > 0.0_dp ) THEN
+       branch_HCl = gamma_HCl / gamma
+       branch_HBr = gamma_HBr / gamma
+    ENDIF
+  END SUBROUTINE Gam_HOI_Ice
+
+  FUNCTION HOIUptkByHBr( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOBr + HBr reaction
+    ! in the stratosphere and in tropospheric clouds.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: branch,       branch_0,     brIce
+    REAL(dp) :: brLiq,        dummy,        gammaLiq
+    REAL(dp) :: gammaIce,     k_HOI_Cl,    k_HOI_Br
+    REAL(dp) :: k_HOI_HSO3m, k_HOI_SO3mm, k_tot
+    REAL(dp) :: srMw
+    !
+    k        = 0.0_dp
+    brIce    = 0.0_dp
+    brLiq    = 0.0_dp
+    gammaIce = 0.0_dp
+    gammaLiq = 0.0_dp
+    srMw     = SR_MW(ind_HOI)
+    !
+!    IF ( H%stratBox ) THEN
+!       !
+!       ! Uptake on tropospheric (origin) sulfate in stratosphere
+!       gammaLiq = 0.25_dp
+!       k = k + Ars_L1k( H%xArea(SUL), H%xRadi(SUL), gammaLiq, srMw )
+!       !
+!       ! Uptake on strat sulfate liquid aerosol
+!       k = k + H%xArea(SLA) * H%KHETI_SLA(HOBr_plus_HBr)
+!       !
+!       ! Uptake on irregular ice cloud
+!       gammaIce = 0.3_dp
+!       IF ( H%natSurface ) gammaIce = 0.001_dp
+!       k = k + Ars_L1k( H%xArea(IIC), H%xRadi(IIC), gammaIce, srMw )
+!       !
+!    ELSE
+
+    IF ( .not. H%stratBox ) THEN
+       !
+       ! HOI + HBr rxn probability in tropospheric liquid cloud
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,                 &
+                        k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm  )
+       !
+       ! Assume same branching ratio for liquid path of HOI + BrSALA in cloud
+       ! as in aerosol (IBr:ICl = 0.15:0.85)
+       brLiq = 0.15_dp * H%frac_Br_CldG
+       !
+       ! Overall probability of HOI uptake and
+       ! ice-path branching ratio for HOI + HBr
+ !      CALL Gam_HOI_Ice( H, gammaIce, dummy, brIce )
+       !
+       ! Compute overall HOI removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, gammaIce, brLiq, brIce )
+       !
+    ENDIF
+
+    ! Assume HOI is limiting, so update the removal rate accordingly
+    k = kIIR1Ltd( C(ind_HOI), C(ind_HBr), k )
+  END FUNCTION HOIUptkByHBr
+
+  FUNCTION HOIUptkByHCl( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOI + HCl reaction
+    ! which only occurs in the stratosphere.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: branch,       branch_0,     brIce
+    REAL(dp) :: brLiq,        dummy,        gammaLiq
+    REAL(dp) :: gammaIce,     k_HOI_Cl,    k_HOI_Br
+    REAL(dp) :: k_HOI_HSO3m, k_HOI_SO3mm, k_tot
+    REAL(dp) :: srMw
+    !
+    k        = 0.0_dp
+    brIce    = 0.0_dp
+    brLiq    = 0.0_dp
+    gammaIce = 0.0_dp
+    gammaLiq = 0.0_dp
+    srMw     = SR_MW(ind_HOI)
+    !
+!    IF ( H%stratBox ) THEN
+!       !
+!       ! Uptake on tropospheric (origin) sulfate in stratosphere
+!       gammaLiq = 0.2_dp
+!       k = k + Ars_L1k( H%xArea(SUL), H%xRadi(SUL), gammaLiq, srMw )
+!       !
+!       ! Uptake on strat sulfate liquid aerosol
+!       k = k + H%xArea(SLA) * H%KHETI_SLA(HOBr_plus_HCl)
+!       !
+!       ! Uptake on irregular ice cloud
+!       gammaIce = 0.3_dp
+!       IF ( H%natSurface ) gammaIce = 0.1_dp
+!       k = k + Ars_L1k( H%xArea(IIC), H%xRadi(IIC), gammaIce, srMw )
+!       !
+!    ELSE
+
+    IF ( .not. H%stratBox ) THEN
+       !
+       ! HOI + HCl rxn probability in tropospheric liquid cloud
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,                  &
+                        k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm   )
+       !
+       ! Assume same branching ratio for liquid path of HOI + BrSALA in cloud
+       ! as in aerosol (IBr:ICl = 0.15:0.85)
+       brLiq = 0.85_dp * H%frac_Cl_CldG
+       !
+       ! Overall probability of HOBr uptake and
+       ! ice-path branching ratio for HOBr + HCl
+!       CALL Gam_HOI_Ice( H, gammaIce, brIce, dummy )
+       !
+       ! Compute overall HOBr removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, gammaIce, brLiq, brIce )
+       !
+    ENDIF
+
+    ! Assume HOI is limiting, so update the removal rate accordingly
+    k = kIIR1Ltd( C(ind_HOI), C(ind_HCl), k )
+  END FUNCTION HOIUptkByHCl
+
+  FUNCTION HOIUptkByHSO3m( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOI + HSO3(-) reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: iLiq,     gammaLiq,     k_HOI_Cl
+    REAL(dp) :: k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm
+    REAL(dp) :: k_tot,     srMw
+    !
+    k        = 0.0_dp
+    iLiq    = 0.0_dp
+    gammaLiq = 0.0_dp
+    srMw     = SR_MW(ind_HOI)
+    !
+    IF ( .not. H%stratBox ) THEN
+       !
+       ! HOI + HBr rxn probability in tropospheric liquid cloud
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,                 &
+                        k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm )
+       !
+       ! Branching ratio for liquid path of HOI + HSO3- in cloud
+       iLiq = k_HOI_HSO3m / k_tot
+       !
+       ! Compute overall HOI removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, 0.0_dp, iLiq, 0.0_dp )
+       !
+    ENDIF
+
+    ! Assume HOI is limiting, so update the removal rate accordingly
+    ! Convert SO2 to HSO3- with the HSO3-/SO2 ratio
+    k = kIIR1Ltd( C(ind_HOI), C(ind_SO2), k ) 
+  END FUNCTION HOIUptkByHSO3m
+
+  FUNCTION HOIUptkBySO3mm( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOBr + HSO3(-) reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: iLiq,     gammaLiq,     k_HOI_Cl
+    REAL(dp) :: k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm
+    REAL(dp) :: k_tot,     srMw
+    !
+    k    = 0.0_dp
+    iLiq    = 0.0_dp
+    gammaLiq = 0.0_dp
+    srMw = SR_MW(ind_HOI)
+    !
+    IF ( .not. H%stratBox ) THEN
+       !
+       ! HOI + SO3-- rxn probability in tropospheric liquid cloud
+       CALL Gam_HOI_CLD(H,         gammaLiq,  k_tot,                 &
+                        k_HOI_Cl, k_HOI_Br, k_HOI_HSO3m, k_HOI_SO3mm )
+       !
+       ! Branching ratio for liquid path of HOI + SO3-- in cloud
+       iLiq = k_HOI_SO3mm / k_tot
+       !
+       ! Compute overall HOBr removal rate in cloud
+       k = k + CloudHet( H, srMw, gammaLiq, 0.0_dp, iLiq, 0.0_dp )
+       !
+    ENDIF
+
+    ! Assume HOI is limiting, so update the removal rate accordingly
+    ! Convert SO2 to SO3-- with the SO3--/SO2 ratio
+    k = kIIR1Ltd( C(ind_HOI), C(ind_SO2), k ) 
+
+  END FUNCTION HOIUptkBySO3mm
+
   !=========================================================================
   ! Hetchem rate-law functions for N2O5
   !=========================================================================
diff --git a/KPP/fullchem/fullchem_SulfurChemFuncs.F90 b/KPP/fullchem/fullchem_SulfurChemFuncs.F90
index ebd2a62fd..4bc81e58f 100644
--- a/KPP/fullchem/fullchem_SulfurChemFuncs.F90
+++ b/KPP/fullchem/fullchem_SulfurChemFuncs.F90
@@ -418,6 +418,7 @@ CONTAINS
 !
     USE fullchem_RateLawFuncs, ONLY : HOBrUptkByHSO3m, HOBrUptkBySO3mm
     USE fullchem_RateLawFuncs, ONLY : HOClUptkByHSO3m, HOClUptkBySO3mm
+    USE fullchem_RateLawFuncs, ONLY : HOIUptkByHSO3m,  HOIUptkBySO3mm
     USE gckpp_Global
     USE gckpp_Parameters
     USE gckpp_Precision
@@ -477,8 +478,8 @@ CONTAINS
     REAL(dp)              :: CVF,        R1,        R2
     REAL(dp)              :: XX,         FC,        LST
     REAL(dp)              :: XX1,        XX2,       XX3
-    REAL(dp)              :: XX4,        XX5,       GNH3
-    REAL(dp)              :: SR,         DENOM
+    REAL(dp)              :: XX4,        XX5,       XX6
+    REAL(dp)              :: GNH3,       SR,        DENOM
 
     ! Pointers
     REAL(fp), POINTER     :: AD(:,:,:)
@@ -515,6 +516,7 @@ CONTAINS
     SR     =  0.0_dp
     SRHOBr =  0.0_dp
     SRHOCl =  0.0_dp
+    SRHOI  =  0.0_dp
     SRO3   =  0.0_dp
     W      =  0.0_dp
     XX     =  0.0_dp  ! All XX* in units of [v/v/timestep]
@@ -523,6 +525,7 @@ CONTAINS
     XX3    =  0.0_dp
     XX4    =  0.0_dp
     XX5    =  0.0_dp
+    XX6    =  0.0_dp
 
     ! FC is guaranteed to be > 1e-4, because HET_DROP_CHEM
     ! is not called otherwise (bmy, 07 Oct 2021)
@@ -622,8 +625,31 @@ CONTAINS
        XX5 = XX5 + WhenExpCantBeDone( R1, R2, K, DTCHEM )
     ENDIF
 
+    ! HSO3- + HOI
+    R1  = C(ind_SO2) * CVF * State_Chm%HSO3_aq(I,J,L)
+    R2  = C(ind_HOI)  * CVF
+    K   = HOIUptkByHSO3m(State_Het) / CVF
+    Arg = ( R1 - R2 ) * ( K * DTCHEM )
+    IF ( IsSafeExp( Arg ) .and. ABS( Arg ) > 0.0_dp ) THEN
+       XX  = EXP( Arg )
+       XX6 = ( R1 * R2 ) * ( XX - 1.0_fp ) / ( ( R1 * XX ) - R2 )
+    ELSE
+       XX6 = WhenExpCantBeDone( R1, R2, K, DTCHEM )
+    ENDIF
+
+    ! SO3-- + HOI (add to HSO3- + HOI rate)
+    R1  = C(ind_SO2) * CVF * State_Chm%SO3_aq(I,J,L)
+    K   = HOIUptkBySO3mm(State_Het) / CVF
+    Arg = ( R1 - R2 ) * ( K * DTCHEM )
+    IF ( IsSafeExp( Arg ) .and. ABS( Arg ) > 0.0_dp ) THEN
+       XX  = EXP( Arg )
+       XX6 = XX6 + ( ( R1 * R2 ) * ( XX - 1.0_dp ) / ( ( R1 * XX ) - R2 ) )
+    ELSE
+       XX6 = XX6 + WhenExpCantBeDone( R1, R2, K, DTCHEM )
+    ENDIF
+
     ! Sum of all rates
-    LST = XX1 + XX2 + XX3 + XX4 + XX5
+    LST = XX1 + XX2 + XX3 + XX4 + XX5 + XX6
 
     !### Debug print
     !IF (I .eq. 12 .and. J .eq. 7 .and. L .eq. 1) THEN
@@ -636,7 +662,8 @@ CONTAINS
        XX3 = ( R1 * XX3 ) / LST
        XX4 = ( R1 * XX4 ) / LST
        XX5 = ( R1 * XX5 ) / LST
-       LST = XX1 + XX2 + XX3 + XX4 + XX5
+       XX6 = ( R1 * XX6 ) / LST
+       LST = XX1 + XX2 + XX3 + XX4 + XX5 + XX6
      ENDIF
 
     ! Convert gas phase concentrations from [v/v] to [pptv]
@@ -772,12 +799,14 @@ CONTAINS
     SRO3   = SR * SafeDiv( XX2, DENOM, 0.0_fp )
     SRHOCl = SR * SafeDiv( XX4, DENOM, 0.0_fp )
     SRHOBr = SR * SafeDiv( XX5, DENOM, 0.0_fp )
+    SRHOI  = SR * SafeDiv( XX6, DENOM, 0.0_fp )
     
     ! Convert this rate to a second order rate constant for use in KPP
     ! Make sure division can be done safely
     SRO3   = SafeDiv( SRO3,   ( C(ind_SO2) * C(ind_O3  ) ), 0.0_dp )
     SRHOCl = SafeDiv( SRHOCl, ( C(ind_SO2) * C(ind_HOCl) ), 0.0_dp )
     SRHOBr = SafeDiv( SRHOBr, ( C(ind_SO2) * C(ind_HOBr) ), 0.0_dp )
+    SRHOI  = SafeDiv( SRHOI,  ( C(ind_SO2) * C(ind_HOI ) ), 0.0_dp )
  
     ! Free pointers
     AD     => NULL()
@@ -974,6 +1003,8 @@ CONTAINS
     REAL(fp)              :: fupdateHOCl_0  !XW
     REAL(fp)              :: HCHOCl, KHOCl, f_srhocl, HOCl0 !XW
 
+
+
     REAL(fp)              :: KaqHCHO, KaqHMS, KaqHMS2, HMSc ! JMM, MSL
 
     ! Pointers
-- 
2.30.2


From 736ad024d8dfb2c9d6c663539214ab0091d34318 Mon Sep 17 00:00:00 2001
From: Becky Alexander <beckya@atmos.washington.edu>
Date: Fri, 5 Jul 2024 15:06:43 -0700
Subject: [PATCH 3/4] Add HOCl + Br- = BrCl in trop clouds and aerosol

---
 KPP/fullchem/fullchem.eqn              |   2 +
 KPP/fullchem/fullchem_RateLawFuncs.F90 | 306 ++++++++++++++++++++-----
 2 files changed, 256 insertions(+), 52 deletions(-)

diff --git a/KPP/fullchem/fullchem.eqn b/KPP/fullchem/fullchem.eqn
index 5b28e1020..28e005613 100644
--- a/KPP/fullchem/fullchem.eqn
+++ b/KPP/fullchem/fullchem.eqn
@@ -1450,6 +1450,8 @@ HOCl + HCl = Cl2 + H2O :       HOClUptkByHCl( State_Het );
 HOCl + HBr = BrCl + H2O :      HOClUptkByHBr( State_Het );                                                  {2014/02/03; Eastham2014; SDE}
 HOCl + SALACL = Cl2 + H2O :    HOClUptkBySALACL( State_Het );                                               {2018/01/22; XW}
 HOCl + SALCCL = Cl2 + H2O :    HOClUptkBySALCCL( State_Het );                                               {2018/01/22; XW}
+HOCl + BrSALA = BrCl + H2O :   HOClUptkByBrSALA( State_Het );                                               {2024/07/05; BALEXANDER}
+HOCl + BrSALC = BrCl + H2O :   HOClUptkByBrSALC( State_Het );                                               {2024/07/05; BALEXANDER}
 HOCl + SO2 = SO4 + HCl :       HOClUptkByHSO3m( State_Het ) + HOClUptkBySO3mm( State_Het ) + SRHOCl;        {2023/01/30; Add SRHOCL, BA; 2018/11/08; XW; June 6, 2021, MSL}
 HOBr + HBr = Br2 + H2O :       HOBrUptkByHBr( State_Het );                                                  {2017/09/22; Sherwen2016b;TS,JAS,SDE}
 HOBr + HCl = BrCl + H2O :      HOBrUptkByHCl( State_Het );                                                  {2017/09/22; Sherwen2016b;TS,JAS,SDE}
diff --git a/KPP/fullchem/fullchem_RateLawFuncs.F90 b/KPP/fullchem/fullchem_RateLawFuncs.F90
index da3e0dc02..d843070b2 100644
--- a/KPP/fullchem/fullchem_RateLawFuncs.F90
+++ b/KPP/fullchem/fullchem_RateLawFuncs.F90
@@ -2069,32 +2069,54 @@ CONTAINS
   ! Hetchem rate-law functions for HOCl
   !=========================================================================
 
-  SUBROUTINE Gam_HOCl_Cld( H, gamma, branchCl, branchSO3 )
-    !
+!  SUBROUTINE Gam_HOCl_Cld( H, gamma, branchCl, branchSO3 )
+  SUBROUTINE Gam_HOCl_Cld( H, gamma, k_tot,              &
+                           k_HOCl_Cl, k_HOCl_Br,         &
+                           k_HOCl_HSO3, k_HOCl_HSO3_2      )    
+
     ! Computes the uptake coefficient [1] of HOCl + HSO3 and HOCl + SO3.
     ! Returns reaction rates of Cl and SO3 paths to compute branching ratios.
     !
     TYPE(HetState), INTENT(IN)  :: H             ! Hetchem State
     REAL(dp),       INTENT(OUT) :: gamma         ! Rxn prob [1]
-    REAL(dp),       INTENT(OUT) :: branchCl      ! Branch ratio, Cl path [1]
-    REAL(dp),       INTENT(OUT) :: branchSO3     ! Branch ratio, SO3 path [1]
+!    REAL(dp),       INTENT(OUT) :: branchCl      ! Branch ratio, Cl path [1]
+!    REAL(dp),       INTENT(OUT) :: branchSO3     ! Branch ratio, SO3 path [1]
+    REAL(dp),       INTENT(OUT) :: k_tot
+    REAL(dp),       INTENT(OUT) :: k_HOCl_Cl
+    REAL(dp),       INTENT(OUT) :: k_HOCl_Br
+    REAL(dp),       INTENT(OUT) :: k_HOCl_HSO3
+    REAL(dp),       INTENT(OUT) :: k_HOCl_HSO3_2
     !
     REAL(dp), PARAMETER :: INV_AB = 1.0_dp / 0.8_dp  ! 1/mass accom coeff
     REAL(dp), PARAMETER :: D_l    = 2.0e-5_dp        ! Liq diff phase coeff
     !
-    REAL(dp) :: cavg,  gb_tot, H_X, k_Cl
-    REAL(dp) :: k_SO3, k_tot,  l_r, M_X
+!    REAL(dp) :: cavg,  gb_tot, H_X, k_Cl
+!    REAL(dp) :: k_SO3, k_tot,  l_r, M_X
+    REAL(dp) :: gd,   M_X,  cavg,  H_X,   gb_tot
+    REAL(dp) :: ybr2, l_r,  C_Hp1, C_Hp2, Br_over_Cl
+
+   ! Follow Roberts et al, (2014) assuming that it also applies to HOCl + X-
+    C_Hp1  = MIN( H%H_conc_lCl, 1.0e-6_dp )
+    C_Hp2  = MIN( H%H_conc_lCl, 1.0e-2_dp )
+    C_Hp1  = MAX( C_Hp1,        1.0e-9_dp )
+    C_Hp2  = MAX( C_Hp2,        1.0e-6_dp )
     !
     ! Reaction rates, Cl and SO3 paths [1/s]
-    k_Cl      = 1.5e+4_dp * H%H_Conc_LCL  * H%Cl_conc_Cld
-    k_SO3     = 2.8e+5_dp * H%TSO3_aq
-    k_tot     = k_Cl + k_SO3
+!    k_Cl      = 1.5e+4_dp * H%H_Conc_LCL  * H%Cl_conc_Cld
+    k_HOCl_Cl     = 1.5e+4_dp * H%Cl_conc_Cld * C_Hp1
+    k_HOCl_Br     = 1.32e+6_dp * H%Br_conc_Cld * C_Hp2 ![Kumar and Margerum, 1987]
+!    k_SO3     = 2.8e+5_dp * H%TSO3_aq
+    k_HOCl_HSO3   = 2.8e+5_dp * H%HSO3_aq ! [Liu and Abbatt, 2020]
+    k_HOCl_HSO3_2 = 7.6e+8_dp * H%SO3_aq ! [Fogelman et al., 1989]
+!    k_tot     = k_Cl + k_SO3
+    k_tot = k_HOCl_Cl + k_HOCl_Br + k_HOCl_HSO3 + k_HOCl_HSO3_2
+
     !
     ! Compute reactive uptake coefficient [1] and branching ratio [1], Cl path
     ! but avoid division by zero
     gamma     = 0.0_dp
-    branchCl  = 0.0_dp
-    branchSO3 = 0.0_dp
+!    branchCl  = 0.0_dp
+!    branchSO3 = 0.0_dp
     !
     IF ( k_tot > 0.0_dp ) THEN
        !
@@ -2111,12 +2133,13 @@ CONTAINS
        gb_tot    = gb_tot * ReactoDiff_Corr( H%rLiq, l_r )
        !
        gamma     = 1.0_dp / ( INV_AB + 1.0_dp / gb_tot )
-       branchCl  = k_Cl   / k_tot
-       branchSO3 = k_SO3  / k_tot
+!       branchCl  = k_Cl   / k_tot
+!       branchSO3 = k_SO3  / k_tot
     ENDIF
   END SUBROUTINE Gam_HOCl_Cld
 
-  SUBROUTINE Gam_HOCl_AER( H, radius, C_Hp, C_Cl, gamma )
+!  SUBROUTINE Gam_HOCl_AER( H, radius, C_Hp, C_Cl, gamma )
+  SUBROUTINE Gam_HOCl_AER( H, radius, C_Hp, C_Cl, C_Br, gamma )
     !
     ! Calculates reactive uptake coefficients [1] for the reactions
     ! HOCl + SALACL and HOCl + SALCCL.
@@ -2125,13 +2148,17 @@ CONTAINS
     REAL(dp),       INTENT(IN)  :: radius        ! Radius [cm]
     REAL(dp),       INTENT(IN)  :: C_Hp          ! H+ conc [mol/L]
     REAL(dp),       INTENT(IN)  :: C_Cl          ! Cl- conc [mol/L]
+    REAL(dp),       INTENT(IN)  :: C_Br          ! Br- conc [mol/L]
     REAL(dp),       INTENT(OUT) :: gamma
     !
     REAL(dp), PARAMETER :: INV_AB = 1.0_dp / 0.8_dp ! 1/mass accum coeff
     REAL(dp), PARAMETER :: D_l    = 2.0e-5_dp       ! Liq phase diffusion coeff
-    REAL(dp), PARAMETER :: K_TER  = 1.5e+4_dp       ! Units: M-1 s-1
+!    REAL(dp), PARAMETER :: K_TER  = 1.5e+4_dp       ! Units: M-1 s-1
     !
     REAL(dp) :: cavg, gb, H_X, l_r, M_X
+    REAL(dp) :: C_Hp1,     C_Hp2
+    REAL(dp) :: k_tot, k_HOCl_Cl, k_HOCl_Br, gb_tot
+
     !
     gamma = 0.0_dp
     !
@@ -2145,12 +2172,30 @@ CONTAINS
     ! Henry's law
     H_X   = ( HENRY_K0(ind_HOCl) * CON_ATM_BAR )                             &
           * EXP( HENRY_CR(ind_HOCl) * ( INV_TEMP - INV_T298 ) )
-    l_r   = SQRT( D_l / ( K_TER * C_Hp * C_Cl ) )
-    gb    = FOUR_R_T * H_X * l_r * K_TER * C_Hp * C_Cl / cavg
-    gb    = gb * ReactoDiff_Corr( radius, l_r )
+
+    ! Follow Roberts et al, (2014) assuming same pH-dependence for HOCl as HOBr
+    C_Hp1     = MAX( MIN( C_Hp, 1.0e-6_dp ), 1.0e-9_dp )
+    C_Hp2     = MAX( MIN( C_Hp, 1.0e-2_dp ), 1.0e-6_dp )
+    !
+    ! Rates for each HOBr + {Cl-, Br-} rxn
+    k_HOCl_Cl = 2.8e+4_dp  * C_Cl     * C_Hp1  ! [Nagy et al., 1988]
+    k_HOCl_Br = 1.32e+6_dp * C_Br     * C_Hp2  ! [Kumar and Margerum, 1987]   
+    k_tot     = k_HOCl_Cl  + k_HOCl_Br
+
+    ! l_r is diffusive length scale [cm];
+    ! gb is Bulk reaction coefficient [unitless]
+    IF ( k_tot > 0.0_dp ) THEN
+!    l_r   = SQRT( D_l / ( K_TER * C_Hp * C_Cl ) )
+       l_r    = SQRT( D_l / k_tot )
+!    gb    = FOUR_R_T * H_X * l_r * K_TER * C_Hp * C_Cl / cavg
+!    gb    = gb * ReactoDiff_Corr( radius, l_r )
+       gb_tot = FOUR_R_T * H_X * l_r * k_tot / cavg
+       gb_tot = gb_tot * ReactoDiff_Corr( radius, l_r )
+       gamma  = 1.0_dp / ( INV_AB + 1.0 / gb_tot )
+    ENDIF
     !
     ! Reactive uptake coefficient [1]
-    gamma = 1.0_dp / ( INV_AB  +  1.0_dp / gb )
+!    gamma = 1.0_dp / ( INV_AB  +  1.0_dp / gb )
   END SUBROUTINE Gam_HOCl_Aer
 
   FUNCTION HOClUptkByHCl( H ) RESULT( k )
@@ -2161,7 +2206,10 @@ CONTAINS
     REAL(dp)                   :: k              ! rxn rate [1/s]
     !
     REAL(dp) :: branch, branchCl, brIce, dummy
-    REAL(dp) :: gamma,  gammaIce, srMw
+    REAL(dp) :: gamma,  gammaIce, srMw, k_tot
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
+
     !
     k    = 0.0_dp
     srMw = SR_MW(ind_HOCl)
@@ -2180,23 +2228,24 @@ CONTAINS
        IF ( H%natSurface ) gamma = 0.1_dp      ! Rxn prob, NAT
        k = k + Ars_L1K( H%xArea(IIC), H%xRadi(IIC), gamma, srMw )
 
-       ! Assume HOCl is limiting, so recompute reaction rate accordingly
-       k = kIIR1Ltd( C(ind_HOCl), C(ind_HCl), k )
-       !
-       RETURN
-    ENDIF
-    !
+   ELSE
+
     ! HOCl + HCl uptake coeff [1] & branch ratio [1] in trop liquid cloud
-    CALL Gam_HOCl_Cld( H, gamma, branchCl, dummy )
-    branch = branchCl * H%frac_Cl_CldG
+!    CALL Gam_HOCl_Cld( H, gamma, branchCl, dummy )
+!    branch = branchCl * H%frac_Cl_CldG
+       CALL Gam_HOCl_Cld( H, gamma, k_tot,            &
+                          k_HOCl_Cl, k_HOCl_Br,       &
+                          k_HOCl_HSO3, k_HOCl_HSO3_2   )
+       branch = ( k_HOCl_Cl / k_tot ) * H%frac_Cl_CldG
+
     !
     ! HOCl + HCl uptake coeff [1] & branch ratio [1] in trop ice cloud
-    gammaIce = 0.22_dp * H%HCl_theta
-    brIce    = 1.0_dp
-    !
-    ! Compute overall HOCl + HCl uptake rate accounting for cloud fraction
-    k = k + CloudHet( H, srMw, gamma, gammaIce, branch, brIce )
-    !
+       gammaIce = 0.22_dp * H%HCl_theta
+       brIce    = 1.0_dp
+       k = k + CloudHet( H, srMw, gamma, gammaIce, branch, brIce )
+
+    ENDIF
+
     ! Assume HOCl is limiting, so recompute reaction rate accordingly
     k = kIIR1Ltd( C(ind_HOCl), C(ind_HCl), k )
   END FUNCTION HOClUptkByHCl
@@ -2208,7 +2257,10 @@ CONTAINS
     TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
     REAL(dp)                   :: k              ! rxn rate [1/s]
     !
-    REAL(dp) :: gamma, srMw
+    REAL(dp) :: gamma, srMw, k_tot
+    REAL(dp) :: branch, gammaIce, brIce
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
     !
     k    = 0.0_dp
     srMw = SR_MW(ind_HOCl)
@@ -2225,6 +2277,21 @@ CONTAINS
        ! HOCl + HBr on irregular ice cloud (ice and NAT surface)
        gamma = 0.3_dp
        k = k + Ars_L1K( H%xArea(IIC), H%xRadi(IIC), gamma, srMw )
+    ELSE
+       ! HOCl + HBr uptake coeff [1] & branch ratio [1] in trop liquid cloud
+       CALL Gam_HOCl_Cld( H, gamma, k_tot,              &
+                          k_HOCl_Cl, k_HOCl_Br,         &
+                          k_HOCl_HSO3, k_HOCl_HSO3_2     )
+        branch = ( k_HOCl_Br / k_tot ) * H%frac_Br_CldG
+       !
+       ! HOCl + HCl uptake coeff [1] & branch ratio [1] in trop ice cloud
+       ! Assume same uptake coeff for HBr
+       gammaIce = 0.22_dp * H%HCl_theta
+       brIce    = 1.0_dp
+       !
+       ! Compute overall HOCl + HCl uptake rate accounting for cloud fraction
+       k = k + CloudHet( H, srMw, gamma, gammaIce, branch, brIce )
+
     ENDIF
     !
     ! Assume HOCl is limiting, so recompute reaction rate accordingly
@@ -2243,7 +2310,10 @@ CONTAINS
     REAL(dp)                   :: k              ! rxn rate [1/s]
     !
     REAL(dp) :: area,  branch, branchCl
-    REAL(dp) :: dummy, gamma,  srMw
+    REAL(dp) :: dummy, gamma,  srMw, k_tot
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
+
     !
     k    = 0.0_dp
     srMw = SR_MW(ind_HOCl)
@@ -2252,8 +2322,13 @@ CONTAINS
     IF ( .not. H%stratBox ) THEN
        !
        ! HOCl + SALACL uptake coeff [1] & branch ratio [1], liquid path
-       CALL Gam_HOCl_Cld( H, gamma, branchCl, dummy )
-       branch = branchCl * H%frac_Cl_CldA
+!       CALL Gam_HOCl_Cld( H, gamma, branchCl, dummy )
+!       branch = branchCl * H%frac_Cl_CldA
+       CALL Gam_HOCl_Cld( H, gamma, k_tot,                &
+                          k_HOCl_Cl, k_HOCl_Br,           &
+                          k_HOCl_HSO3, k_HOCl_HSO3_2       )
+       branch = ( k_HOCl_Cl / k_tot ) * H%frac_Cl_CldA
+
        !
        ! HOCl + HCl uptake rate [1/s] accounting for cloud fraction
        k = k + CloudHet( H, srMw, gamma, 0.0_dp, branch, 0.0_dp )
@@ -2261,8 +2336,11 @@ CONTAINS
     !
     ! Compute HOCl + SALACL uptake rate [1/s] on acidic aerosols in clear-sky
     IF ( H%SSA_is_Acid ) THEN
-       CALL Gam_HOCl_Aer( H, H%aClRadi, H%H_conc_SSA, H%Cl_conc_SSA, gamma )
-       area = H%ClearFr * H%aClArea * H%f_Acid_SSA
+!       CALL Gam_HOCl_Aer( H, H%aClRadi, H%H_conc_SSA, H%Cl_conc_SSA, gamma )
+       CALL Gam_HOCl_Aer( H, H%aClRadi, H%H_conc_SSA, &
+                          H%Cl_conc_SSA, H%Br_conc_SSA, gamma )
+!       area = H%ClearFr * H%aClArea * H%f_Acid_SSA
+       area = H%ClearFr * H%aClArea * (1.0_dp - H%f_Alk_SSA)
        k    = k + Ars_L1k( area, H%aClRadi, gamma, srMw )
     ENDIF
     !
@@ -2278,7 +2356,9 @@ CONTAINS
     REAL(dp)                   :: k              ! rxn rate [1/s]
     !
     REAL(dp) :: area,  branch, branchCl
-    REAL(dp) :: dummy, gamma,  srMw
+    REAL(dp) :: dummy, gamma,  srMw, k_tot
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
     !
     k    = 0.0_dp
     srMw = SR_MW(ind_HOCl)
@@ -2287,17 +2367,24 @@ CONTAINS
     IF ( .not. H%stratBox ) THEN
        !
        ! HOCl + SALACL uptake coeff [1] & branch ratio [1], liquid path
-       CALL Gam_HOCl_Cld( H, gamma, branchCl, dummy )
-       branch = branchCl * H%frac_Cl_CldC
-       !
+!       CALL Gam_HOCl_Cld( H, gamma, branchCl, dummy )
+!       branch = branchCl * H%frac_Cl_CldC
+       CALL Gam_HOCl_Cld( H, gamma, k_tot,           &
+                          k_HOCl_Cl, k_HOCl_Br,      &
+                         k_HOCl_HSO3, k_HOCl_HSO3_2   )
+       branch = ( k_HOCl_Cl / k_tot ) * H%frac_Cl_CldC       
+
        ! HOCl + HCl uptake rate [1/s] accounting for cloud fraction
        k = k + CloudHet( H, srMw, gamma, 0.0_dp, branch, 0.0_dp )
     ENDIF
     !
     ! Compute HOCl + SALCCL uptake rate [1/s] on acidic aerosols in clear-sky
     IF ( H%SSC_is_Acid ) THEN
-       CALL Gam_HOCl_Aer( H, H%xRadi(SSC), H%H_conc_SSC, H%Cl_conc_SSC, gamma )
-       area = H%ClearFr * H%xArea(SSC) * H%f_Acid_SSC
+!       CALL Gam_HOCl_Aer( H, H%xRadi(SSC), H%H_conc_SSC, H%Cl_conc_SSC, gamma )
+!       area = H%ClearFr * H%xArea(SSC) * H%f_Acid_SSC
+       CALL Gam_HOCl_Aer( H, H%xRadi(SSC), H%H_conc_SSC, &
+                          H%Cl_conc_SSC, H%Br_conc_SSC, gamma )
+       area = H%ClearFr * H%xArea(SSC) * (1.0_dp - H%f_Alk_SSC)
        k    = k + Ars_L1k( area, H%xRadi(SSC), gamma, srMw )
     ENDIF
     !
@@ -2305,6 +2392,107 @@ CONTAINS
     k = kIIR1Ltd( C(ind_HOCl), C(ind_SALCCL), k )
   END FUNCTION HOClUptkBySALCCL
 
+  FUNCTION HOClUptkByBrSALA( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOCl + BrSALA reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: area,  branch, branchCl
+    REAL(dp) :: dummy, gamma,  srMw, k_tot
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
+    !
+    k    = 0.0_dp
+    srMw = SR_MW(ind_HOCl)
+    !
+    ! Compute HOCl + SALACL uptake in tropospheric liquid cloud
+    IF ( .not. H%stratBox ) THEN
+       !
+       ! HOCl + SALACL uptake coeff [1] & branch ratio [1], liquid path
+      CALL Gam_HOCl_Cld( H, gamma, k_tot,             &
+                         k_HOCl_Cl, k_HOCl_Br,        &
+                         k_HOCl_HSO3, k_HOCl_HSO3_2    )
+      branch = ( k_HOCl_Br / k_tot ) * H%frac_Br_CldA
+       !
+       ! HOCl + HCl uptake rate [1/s] accounting for cloud fraction
+       k = k + CloudHet( H, srMw, gamma, 0.0_dp, branch, 0.0_dp )
+    ENDIF
+    !
+    ! Compute HOCl + BrSALA uptake rate [1/s] on acidic aerosols in clear-sky
+    IF ( H%SSA_is_Acid ) THEN
+!       CALL Gam_HOCl_Aer( H, H%aClRadi, H%H_conc_SSA, H%Cl_conc_SSA, gamma )
+       CALL Gam_HOCl_Aer( H, H%aClRadi, H%H_conc_SSA, H%Cl_conc_SSA,   &
+                          H%Br_conc_SSA, gamma )
+
+       ! Branching ratio (depends on Br- / Cl- ratio)
+       ! Assume same branching ratio for HOCl as HOBr for now
+       branch = 0.9_dp
+       IF ( H%Br_over_Cl_SSA <= 5.0e-4_dp ) THEN
+          branch = Br2_Yield( H%Br_over_Cl_SSA )
+       ENDIF
+
+!       area = H%ClearFr * H%aClArea
+       area = H%ClearFr * H%aClArea * (1.0_dp - H%f_Alk_SSA)
+       k    = k + Ars_L1k( area, H%aClRadi, gamma, srMw ) * branch
+    ENDIF
+    !
+    ! Assume HOCl is limiting, so recompute reaction rate accordingly
+    k = kIIR1Ltd( C(ind_HOCl), C(ind_SALACL), k )
+  END FUNCTION HOClUptkByBrSALA
+
+  FUNCTION HOClUptkByBrSALC( H ) RESULT( k )
+    !
+    ! Computes the uptake rate [1/s] for the HOCl + SALCCL reaction.
+    !
+    TYPE(HetState), INTENT(IN) :: H              ! Hetchem State
+    REAL(dp)                   :: k              ! rxn rate [1/s]
+    !
+    REAL(dp) :: area,  branch, branchCl
+    REAL(dp) :: dummy, gamma,  srMw, k_tot
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
+    !
+    k    = 0.0_dp
+    srMw = SR_MW(ind_HOCl)
+    !
+    ! Compute HOCl + SALACL uptake in tropospheric liquid cloud
+    IF ( .not. H%stratBox ) THEN
+       !
+       ! HOCl + SALACL uptake coeff [1] & branch ratio [1], liquid path
+       CALL Gam_HOCl_Cld( H, gamma, k_tot,                 &
+                          k_HOCl_Cl, k_HOCl_Br,            &
+                          k_HOCl_HSO3, k_HOCl_HSO3_2        )
+        branch = ( k_HOCl_Br / k_tot ) * H%frac_Cl_CldC
+       !
+       ! HOCl + HCl uptake rate [1/s] accounting for cloud fraction
+       k = k + CloudHet( H, srMw, gamma, 0.0_dp, branch, 0.0_dp )
+    ENDIF
+    !
+    ! Compute HOCl + SALCCL uptake rate [1/s] on acidic aerosols in clear-sky
+    IF ( H%SSC_is_Acid ) THEN
+!       CALL Gam_HOCl_Aer( H, H%xRadi(SSC), H%H_conc_SSC, H%Cl_conc_SSC, gamma )
+       CALL Gam_HOCl_Aer( H, H%aClRadi, H%H_conc_SSA, H%Cl_conc_SSA,   &
+                          H%Br_conc_SSA, gamma )
+
+       ! Branching ratio (depends on Br- / Cl- ratio)
+       ! Assume same branching ratio for HOCl as HOBr for now
+       branch = 0.9_dp
+       IF ( H%Br_over_Cl_SSA <= 5.0e-4_dp ) THEN
+          branch = Br2_Yield( H%Br_over_Cl_SSA )
+       ENDIF
+
+!       area = H%ClearFr * H%xArea(SSC)
+       area = H%ClearFr * H%xArea(SSC) * (1.0_dp - H%f_Alk_SSC)
+       k    = k + Ars_L1k( area, H%xRadi(SSC), gamma, srMw ) * branch
+    ENDIF
+    !
+    ! Assume HOCl is limiting, so recompute reaction rate accordingly
+    k = kIIR1Ltd( C(ind_HOCl), C(ind_SALCCL), k )
+  END FUNCTION HOClUptkByBrSALC
+
+
   FUNCTION HOClUptkByHSO3m( H ) RESULT( k )
     !
     ! Computes the uptake rate [1/s] for the HOCl + HSO3- reaction.
@@ -2313,7 +2501,9 @@ CONTAINS
     REAL(dp)                   :: k              ! rxn rate [1/s]
     !
     REAL(dp) :: area,  branch, branchSO3
-    REAL(dp) :: dummy, gamma,  srMw
+    REAL(dp) :: dummy, gamma,  srMw, k_tot
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
     !
     k    = 0.0_dp
     srMw = SR_MW(ind_HOCl)
@@ -2322,8 +2512,13 @@ CONTAINS
     IF ( .not. H%stratBox ) THEN
        !
        ! HOCl + HSO3- uptake coeff [1] & branch ratio [1], liquid path
-       CALL Gam_HOCl_Cld( H, gamma, dummy, branchSO3 )
-       branch = branchSO3 * H%frac_HSO3_aq
+!       CALL Gam_HOCl_Cld( H, gamma, dummy, branchSO3 )
+!       branch = branchSO3 * H%frac_HSO3_aq
+       CALL Gam_HOCl_Cld( H, gamma, k_tot,              &
+                          k_HOCl_Cl, k_HOCl_Br,         &
+                          k_HOCl_HSO3, k_HOCl_HSO3_2     )
+       branch = ( k_HOCl_HSO3 / k_tot ) * H%frac_HSO3_aq
+
        !
        ! HOCl + HSO3- uptake rate [1/s] accounting for cloud fraction
        k = k + CloudHet( H, srMw, gamma, 0.0_dp, branch, 0.0_dp )
@@ -2342,7 +2537,9 @@ CONTAINS
     REAL(dp)                   :: k              ! rxn rate [1/s]
     !
     REAL(dp) :: area,  branch, branchSO3
-    REAL(dp) :: dummy, gamma,  srMw
+    REAL(dp) :: dummy, gamma,  srMw, k_tot
+    REAL(dp) :: k_HOCl_Cl, k_HOCl_Br
+    REAL(dp) :: k_HOCl_HSO3, k_HOCl_HSO3_2
     !
     k    = 0.0_dp
     srMw = SR_MW(ind_HOCl)
@@ -2351,8 +2548,13 @@ CONTAINS
     IF ( .not. H%stratBox ) THEN
        !
        ! HOCl + SO3-- uptake coeff [1] & branch ratio [1], liquid path
-       CALL Gam_HOCl_Cld( H, gamma, dummy, branchSO3 )
-       branch = branchSO3 * H%frac_SO3_aq
+!       CALL Gam_HOCl_Cld( H, gamma, dummy, branchSO3 )
+!       branch = branchSO3 * H%frac_SO3_aq
+       CALL Gam_HOCl_Cld( H, gamma, k_tot,              &
+                          k_HOCl_Cl, k_HOCl_Br,         &
+                          k_HOCl_HSO3, k_HOCl_HSO3_2     )
+       branch = ( k_HOCl_HSO3_2 / k_tot ) * H%frac_SO3_aq
+
        !
        ! HOCl + SO3-- uptake rate [1/s] accounting for cloud fraction
        k = k + CloudHet( H, srMw, gamma, 0.0_dp, branch, 0.0_dp )
-- 
2.30.2


From f63830b8fdce090b4d630a0955e2dc70c8b753cb Mon Sep 17 00:00:00 2001
From: Becky Alexander <beckya@atmos.washington.edu>
Date: Fri, 5 Jul 2024 15:24:00 -0700
Subject: [PATCH 4/4] Remove H%HSO3m and H%SO3mm from second-order rate
 calculation for reaction of HOCl with HSO3- and SO32- because this is already
 taken care of in Gam_HOCl_Cld.

Signed-off-by: Becky Alexander <beckya@atmos.washington.edu>
---
 KPP/fullchem/fullchem_RateLawFuncs.F90 | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/KPP/fullchem/fullchem_RateLawFuncs.F90 b/KPP/fullchem/fullchem_RateLawFuncs.F90
index d843070b2..346c41066 100644
--- a/KPP/fullchem/fullchem_RateLawFuncs.F90
+++ b/KPP/fullchem/fullchem_RateLawFuncs.F90
@@ -2526,7 +2526,8 @@ CONTAINS
     !
     ! Assume HOCl is limiting, so recompute reaction rate accordingly
     ! Convert SO2 to HSO3- with the HSO3-/SO2 ratio
-    k = kIIR1Ltd( C(ind_HOCl), C(ind_SO2), k ) * H%HSO3m
+!    k = kIIR1Ltd( C(ind_HOCl), C(ind_SO2), k ) * H%HSO3m
+    k = kIIR1Ltd( C(ind_HOCl), C(ind_SO2), k ) 
   END FUNCTION HOClUptkByHSO3m
 
   FUNCTION HOClUptkBySO3mm( H ) RESULT( k )
@@ -2562,7 +2563,8 @@ CONTAINS
     !
     ! Assume HOCl is limiting, so recompute reaction rate accordingly
     ! Convert SO2 to SO3-- with the SO3--/SO2 ratio
-    k = kIIR1Ltd( C(ind_HOCl), C(ind_SO2), k ) * H%SO3mm
+!    k = kIIR1Ltd( C(ind_HOCl), C(ind_SO2), k ) * H%SO3mm
+    k = kIIR1Ltd( C(ind_HOCl), C(ind_SO2), k ) 
   END FUNCTION HOClUptkBySO3mm
 
   !=========================================================================
-- 
2.30.2

